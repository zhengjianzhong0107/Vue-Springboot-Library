{"version":3,"sources":["webpack:///./src/views/BookWithUser.vue","webpack:///./src/views/BookWithUser.vue?ca66"],"names":["class","style","inline","size","label","search1","placeholder","clearable","prefix","search2","user","role","search3","type","load","clear","title","deleteBatch","reference","data","tableData","stripe","border","handleSelectionChange","width","prop","sortable","fixed","handleEdit","scope","row","handleDelete","handlereProlong","disabled","prolong","currentPage","page-sizes","page-size","pageSize","layout","total","handleSizeChange","handleCurrentChange","dialogVisible2","footer","save","model","form","label-width","isbn","bookName","nickName","created","userStr","sessionStorage","getItem","this","JSON","parse","name","methods","val","forms","length","request","post","then","res","code","success","error","msg","warning","get","params","pageNum","console","log","records","id","form3","stringify","nowDate","Date","deadtime","setDate","getDate","format","message","form2","dialogVisible","__exports__","render"],"mappings":"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","file":"js/chunk-2d0c0df2.545e0c5d.js","sourcesContent":["<template>\n  <div class=\"home\" style =\"padding: 10px\">\n    <!-- 搜索-->\n    <div style=\"margin: 10px 0;\">\n\n      <el-form inline=\"true\" size=\"small\" >\n        <el-form-item label=\"图书编号\" >\n          <el-input v-model=\"search1\" placeholder=\"请输入图书编号\"  clearable>\n            <template #prefix><el-icon class=\"el-input__icon\"><search/></el-icon></template>\n          </el-input>\n        </el-form-item >\n        <el-form-item label=\"图书名称\" >\n          <el-input v-model=\"search2\" placeholder=\"请输入图书名称\"  clearable>\n            <template #prefix><el-icon class=\"el-input__icon\"><search /></el-icon></template>\n          </el-input>\n        </el-form-item >\n        <el-form-item label=\"借阅者\" v-if=\"user.role == 1\">\n          <el-input v-model=\"search3\" placeholder=\"请输入借阅者昵称\"  clearable>\n            <template #prefix><el-icon class=\"el-input__icon\"><search /></el-icon></template>\n          </el-input>\n        </el-form-item >\n        <el-form-item>\n          <el-button type=\"primary\" style=\"margin-left: 1%\" @click=\"load\" size=\"mini\">查询</el-button>\n        </el-form-item>\n        <el-form-item>\n          <el-button size=\"mini\"  type=\"danger\" @click=\"clear\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n    <!-- 按钮-->\n    <div style=\"margin: 10px 0;\" >\n      <el-popconfirm title=\"确认删除?\" @confirm=\"deleteBatch\" v-if=\"user.role == 1\">\n        <template #reference>\n          <el-button type=\"danger\" size=\"mini\" >批量删除</el-button>\n        </template>\n      </el-popconfirm>\n    </div>\n    <!-- 数据字段-->\n    <el-table :data=\"tableData\" stripe border=\"true\" @selection-change=\"handleSelectionChange\">\n      <el-table-column v-if=\"user.role ==1\"\n          type=\"selection\"\n          width=\"55\">\n      </el-table-column>\n      <el-table-column prop=\"isbn\" label=\"图书编号\" sortable />\n      <el-table-column prop=\"bookName\" label=\"图书名称\" />\n      <el-table-column prop=\"nickName\" label=\"借阅者\" />\n      <el-table-column prop=\"lendtime\" label=\"借阅时间\" />\n      <el-table-column prop=\"deadtime\" label=\"最迟归还日期\" />\n      <el-table-column prop=\"prolong\" label=\"可续借次数\" />\n      <el-table-column fixed=\"right\" label=\"操作\" >\n        <template v-slot=\"scope\">\n          <el-button  size=\"mini\" @click =\"handleEdit(scope.row)\" v-if=\"user.role == 1\">修改</el-button>\n          <el-popconfirm title=\"确认删除?\" @confirm=\"handleDelete(scope.row) \" v-if=\"user.role == 1\">\n            <template #reference>\n              <el-button type=\"danger\" size=\"mini\" >删除</el-button>\n            </template>\n          </el-popconfirm>\n          <el-popconfirm title=\"确认续借(续借一次延长30天)?\" @confirm=\"handlereProlong(scope.row)\" v-if=\"user.role == 2\" :disabled=\"scope.row.prolong == 0\">\n            <template #reference>\n              <el-button type=\"danger\" size=\"mini\" :disabled=\"scope.row.prolong == 0\" >续借</el-button>\n            </template>\n          </el-popconfirm>\n        </template>\n      </el-table-column>\n    </el-table>\n    <!--    分页-->\n    <div style=\"margin: 10px 0\">\n      <el-pagination\n          v-model:currentPage=\"currentPage\"\n          :page-sizes=\"[5, 10, 20]\"\n          :page-size=\"pageSize\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"total\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n      >\n      </el-pagination>\n\n      <el-dialog v-model=\"dialogVisible2\" title=\"修改借阅信息\" width=\"30%\">\n        <el-form :model=\"form\" label-width=\"120px\">\n\n          <el-form-item label=\"图书编号\">\n            <el-input style=\"width: 80%\" v-model=\"form.isbn\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"图书名称\">\n            <el-input style=\"width: 80%\" v-model=\"form.bookName\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"借阅者\">\n            <el-input style=\"width: 80%\" v-model=\"form.nickName\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"续借次数\">\n            <el-input style=\"width: 80%\" v-model=\"form.prolong\"></el-input>\n          </el-form-item>\n        </el-form>\n        <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible2 = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"save\">确 定</el-button>\n      </span>\n        </template>\n      </el-dialog>\n\n    </div>\n  </div>\n</template>\n\n<script>\n// @ is an alias to /src\nimport request from \"../utils/request\";\nimport {ElMessage} from \"element-plus\";\nimport moment from \"moment\";\nexport default {\n  created(){\n    let userStr = sessionStorage.getItem(\"user\") ||\"{}\"\n    this.user = JSON.parse(userStr)\n    this.load()\n  },\n  name: 'bookwithuser',\n  methods: {\n\n    handleSelectionChange(val){\n      this.forms = val\n    },\n    deleteBatch(){\n      if (!this.forms.length) {\n        ElMessage.warning(\"请选择数据！\")\n        return\n      }\n    //  一个小优化，直接发送这个数组，而不是一个一个的提交删除\n      request.post(\"bookwithuser/deleteRecords\",this.forms).then(res =>{\n        if(res.code === '0'){\n          ElMessage.success(\"批量删除成功\")\n          this.load()\n        }\n        else {\n          ElMessage.error(res.msg)\n        }\n      })\n    },\n    load(){\n      if(this.user.role == 1){\n        request.get(\"/bookwithuser\",{\n          params:{\n            pageNum: this.currentPage,\n            pageSize: this.pageSize,\n            search1: this.search1,\n            search2: this.search2,\n            search3: this.search3,\n          }\n        }).then(res =>{\n          console.log(res)\n          this.tableData = res.data.records\n          this.total = res.data.total\n        })\n      }\n      else {\n        request.get(\"/bookwithuser\",{\n          params:{\n            pageNum: this.currentPage,\n            pageSize: this.pageSize,\n            search1: this.search1,\n            search2: this.search2,\n            search3: this.user.id,\n          }\n        }).then(res =>{\n          console.log(res)\n          this.tableData = res.data.records\n          this.total = res.data.total\n        })\n      }\n    },\n    clear(){\n      this.search1 = \"\"\n      this.search2 = \"\"\n      this.search3 = \"\"\n      this.load()\n    },\n    handleDelete(row){\n      const form3 = JSON.parse(JSON.stringify(row))\n      request.post(\"bookwithuser/deleteRecord\",form3).then(res =>{\n        console.log(res)\n        if(res.code == 0 ){\n          ElMessage.success(\"删除成功\")\n        }\n        else\n          ElMessage.error(res.msg)\n        this.load()\n      })\n    },\n    handlereProlong(row){\n      var nowDate = new Date(row.deadtime);\n      nowDate.setDate(nowDate.getDate()+30);\n      row.deadtime = moment(nowDate).format(\"yyyy-MM-DD HH:mm:ss\");\n      row.prolong = row.prolong -1;\n      request.post(\"/bookwithuser\",row).then(res =>{\n        console.log(res)\n        if(res.code == 0){\n          ElMessage({\n            message: '续借成功',\n            type: 'success',\n          })\n        }\n        else {\n          ElMessage.error(res.msg)\n        }\n        this.load()\n        this.dialogVisible2 = false\n      })\n    },\n    save(){\n      //ES6语法\n      //地址,但是？IP与端口？+请求参数\n      // this.form?这是自动保存在form中的，虽然显示时没有使用，但是这个对象中是有它的\n        request.post(\"/bookwithuser\",this.form).then(res =>{\n          console.log(res)\n          if(res.code == 0){\n            ElMessage({\n              message: '修改信息成功',\n              type: 'success',\n            })\n          }\n          else {\n            ElMessage.error(res.msg)\n          }\n          this.load()\n          this.dialogVisible2 = false\n        })\n    },\n\n    handleEdit(row){\n      this.form = JSON.parse(JSON.stringify(row))\n      this.dialogVisible2 = true\n    },\n    handleSizeChange(pageSize){\n      this.pageSize = pageSize\n      this.load()\n    },\n    handleCurrentChange(pageNum){\n      this.pageNum = pageNum\n      this.load()\n    },\n\n  },\n  data() {\n    return {\n      form: {},\n      form2:{},\n      form3:{},\n      dialogVisible: false,\n      dialogVisible2: false,\n      search1:'',\n      search2:'',\n      search3:'',\n      total:10,\n      currentPage:1,\n      pageSize: 10,\n      tableData: [],\n      user:{},\n      forms:[],\n    }\n  },\n}\n</script>\n","import { render } from \"./BookWithUser.vue?vue&type=template&id=1cf804b8\"\nimport script from \"./BookWithUser.vue?vue&type=script&lang=js\"\nexport * from \"./BookWithUser.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/zhengjianzhong/Desktop/Vue-Springboot-Library-main/vue/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}